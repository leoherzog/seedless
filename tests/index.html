<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seedless Test Suite</title>
  <style>
    body {
      font-family: 'Consolas', 'Monaco', monospace;
      background: #1a1a2e;
      color: #eee;
      padding: 2rem;
      margin: 0;
    }
    h1 {
      color: #4ecdc4;
      margin-bottom: 1rem;
    }
    pre {
      background: #16213e;
      padding: 1.5rem;
      border-radius: 8px;
      overflow-x: auto;
      line-height: 1.6;
    }
    .pass { color: #4ecdc4; }
    .fail { color: #ff6b6b; }
    .summary {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      font-weight: bold;
    }
    .summary.pass { background: #1a472a; }
    .summary.fail { background: #4a1a1a; }
    .loading {
      color: #888;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>Seedless Test Suite</h1>
  <pre id="output"><span class="loading">Running tests...</span></pre>
  <div id="summary"></div>

  <script type="module">
    const output = document.getElementById('output');
    const summaryEl = document.getElementById('summary');

    // Redirect console to page
    const originalLog = console.log;
    const originalError = console.error;
    let outputText = '';

    function escapeHtml(text) {
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    console.log = (...args) => {
      const text = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' ');
      const isPass = text.includes('\u2713');
      const isFail = text.includes('\u2717');
      const className = isPass ? 'pass' : (isFail ? 'fail' : '');
      outputText += className
        ? `<span class="${className}">${escapeHtml(text)}</span>\n`
        : escapeHtml(text) + '\n';
      output.innerHTML = outputText;
      originalLog(...args);
    };

    console.error = (...args) => {
      const text = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' ');
      outputText += `<span class="fail">${escapeHtml(text)}</span>\n`;
      output.innerHTML = outputText;
      originalError(...args);
    };

    // Run tests
    try {
      const { summary, reset } = await import('./run.js');

      // Run each test file
      await import('./bracket-utils.test.js');
      await import('./store.test.js');

      // Show summary
      const passed = summary();
      summaryEl.className = 'summary ' + (passed ? 'pass' : 'fail');
      summaryEl.textContent = passed ? 'All tests passed!' : 'Some tests failed.';
    } catch (e) {
      console.error('Test runner error:', e.message);
      console.error(e.stack);
      summaryEl.className = 'summary fail';
      summaryEl.textContent = 'Test runner error: ' + e.message;
    }
  </script>
</body>
</html>
